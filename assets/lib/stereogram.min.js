/*! Stereogram.js (https://github.com/peeinears/Stereogram.js)
 *
 *  MIT License (http://www.opensource.org/licenses/mit-license.html)
 *  Copyright (c) 2014 Ian Pearce
 */
(function(){"use strict";var a={render:function(b){b=b||{};var c={width:null,height:null,depthMap:null,depthMapper:new a.DepthMapper,imageType:"png",colors:[[255,255,255,255],[0,0,0,255]]};for(var d in c)b.hasOwnProperty(d)||(b[d]=c[d]);var e,f,g,h,i,j;if(b.el&&(!(e="string"==typeof b.el?document.getElementById(b.el):b.el)||!e.tagName))throw"Stereogram: Could not find element: "+b.el;if(!(f=b.width||e.width))throw"Stereogram: width not set and could not be inferred from element: "+b.el;if(!(g=b.height||e.height))throw"Stereogram: height not set and could not be inferred from element: "+b.el;if(b.depthMap)h=b.depthMap;else{if(!b.depthMapper)throw"Stereogram: no depthMap or depthMapper opts given";h=b.depthMapper.generate(f,g)}for(j=0;j<b.colors.length;j++)"string"==typeof b.colors[j]&&(b.colors[j]=this.helpers.hexToRGBa(b.colors[j]));switch(i=this.generatePixelData({width:f,height:g,depthMap:h,colors:b.colors}),e.tagName){case"CANVAS":this.renderToCanvas(e,i,f,g);break;case"IMG":var k=document.createElement("canvas");k.width=f,k.height=g,this.renderToCanvas(k,i,f,g),e.src=k.toDataURL("image/"+(b.imageType||"png"));break;default:throw"Stereogram: el must be either a <canvas> or an <img>"}return this},renderToCanvas:function(a,b,c,d){var e=a.getContext("2d"),f=e.createImageData(c,d);f.data.set(b),e.putImageData(f,0,0)},generatePixelData:function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p=a.width,q=a.height,r=a.depthMap,s=a.colors.length,t=72,u=Math.round(2.5*t),v=1/3,w=new Uint8ClampedArray(p*q*4);for(c=0;c<q;c++){for(o=new Uint16Array(p),b=0;b<p;b++)o[b]=b;for(b=0;b<p;b++)if(l=r[c][b],k=Math.round((1-v*l)*u/(2-v*l)),e=Math.round(b-(k+(k&c&1))/2),f=e+k,0<=e&&f<p){h=1;do{i=l+2*(2-v*l)*h/(v*u),g=r[c][b-h]<i&&r[c][b+h]<i,h++}while(g&&i<1);if(g){for(j=o[e];j!==e&&j!==f;j=o[e])j<f?e=j:(e=f,f=j);o[e]=f}}for(b=p-1;b>=0;b--)if(m=c*p*4+4*b,o[b]===b)for(n=a.colors[Math.floor(Math.random()*s)],d=0;d<4;d++)w[m+d]=n[d];else for(m=c*p*4+4*b,d=0;d<4;d++)w[m+d]=w[c*p*4+4*o[b]+d]}return w},helpers:{hexToRGBa:function(a){var b=/^#?([a-f\d])([a-f\d])([a-f\d])$/i;a=a.replace(b,function(a,b,c,d){return b+b+c+c+d+d});var c=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(a);return c?[parseInt(c[1],16),parseInt(c[2],16),parseInt(c[3],16),255]:null}}},b=function(){};b.prototype.autoResize=!0,b.prototype.make=function(a,b){return[[0]]},b.prototype.generate=function(a,b){return this.autoResize?this.resize(this.make(a,b),a,b):this.make(a,b)},b.prototype.resize=function(a,b,c){var d,e,f,g=[],h=a.length,i=a[0].length;if(i===b&&h===c)return a;for(f=0;f<c;f++)for(g[f]=new Float32Array(b),d=Math.floor(f*h/c),e=0;e<b;e++)g[f][e]=a[d][Math.floor(e*i/b)];return g},b.extend=function(a){var b,c=this,d=function(a){if(!a||"function"!=typeof a&&"object"!=typeof a)return a;for(var b,c,d=1,e=arguments.length;d<e;d++){b=arguments[d];for(c in b)a[c]=b[c]}return a};b=a&&hasOwnProperty.call(a,"constructor")?a.constructor:function(){return c.apply(this,arguments)};var e=function(){this.constructor=b};return e.prototype=c.prototype,b.prototype=new e,a&&d(b.prototype,a),b.__super__=c.prototype,b},a.DepthMapper=b,this.Stereogram=a,this.MagicEye=this.Stereogram}).call(this);